[env:linux_headless]
platform = native@^1.2.1
extra_scripts =
  tools/linux_build_extra.py
build_flags =
  ${env.build_flags}
  -D HASP_MODEL="Linux Headless"
  -D HASP_TARGET_PC=1

  ; ----- Display
  -D TFT_WIDTH=320
  -D TFT_HEIGHT=480
  -D HASP_USE_NULL_DRIVER=1
  ; ----- ArduinoJson
  -D ARDUINOJSON_DECODE_UNICODE=1
  -D HASP_NUM_PAGES=12
  -D HASP_USE_SPIFFS=0
  -D HASP_USE_LITTLEFS=0
  -D HASP_USE_EEPROM=0
  -D HASP_USE_GPIO=0
  -D HASP_USE_CONFIG=1
  -D HASP_USE_DEBUG=1
  -D HASP_USE_PNGDECODE=1
  -D HASP_USE_BMPDECODE=1
  -D HASP_USE_GIFDECODE=0
  -D HASP_USE_JPGDECODE=0
  -D HASP_USE_QRCODE=0
  -D HASP_USE_MQTT=1
  -D MQTT_MAX_PACKET_SIZE=2048
  -D HASP_ATTRIBUTE_FAST_MEM=
  -D IRAM_ATTR=                      ; No IRAM_ATTR available
  -D PROGMEM=                      ; No PROGMEM available
  ; Add recursive dirs for hal headers search
  -D POSIX
  -D PAHO_MQTT_STATIC
  -DPAHO_WITH_SSL=TRUE
  -DPAHO_BUILD_DOCUMENTATION=FALSE
  -DPAHO_BUILD_SAMPLES=FALSE
  -DCMAKE_BUILD_TYPE=Release
  -DCMAKE_VERBOSE_MAKEFILE=TRUE
  -I.pio/libdeps/linux_headless/paho/src
  -I.pio/libdeps/linux_headless/ArduinoJson/src

  ; ----- Statically linked libraries --------------------
  -lm
  -lpthread

lib_deps =
  ${env.lib_deps}
  ${arduinojson.lib_deps}
  https://github.com/eclipse/paho.mqtt.c.git
  https://github.com/fvanroie/lv_drivers

lib_ignore =
  paho
  AXP192
  ArduinoLog
  lv_lib_qrcode
  ETHSPI
  
build_src_filter =
  +<*>
  -<*.h>
  +<../.pio/libdeps/linux_headless/paho/src/*.c>
  -<../.pio/libdeps/linux_headless/paho/src/MQTTClient.c>
  +<../.pio/libdeps/linux_headless/paho/src/MQTTAsync.c>
  +<../.pio/libdeps/linux_headless/paho/src/MQTTAsyncUtils.c>
  -<../.pio/libdeps/linux_headless/paho/src/MQTTVersion.c>
  -<../.pio/libdeps/linux_headless/paho/src/SSLSocket.c>
  -<MQTTClient.c>
  +<MQTTAsync.c>
  +<MQTTAsyncUtils.c>
  -<MQTTVersion.c>
  -<SSLSocket.c>
  -<sys/>
  +<sys/gpio/>
  +<sys/svc/>
  -<hal/>
  +<drv/>
  -<drv/touch>
  +<drv/tft>
  +<dev/>
  -<hal/>
  -<svc/>
  -<hasp_filesystem.cpp>
  +<font/>
  +<hasp/>
  +<lang/>
  -<log/>
  +<mqtt/>
  +<../.pio/libdeps/linux_headless/ArduinoJson/src/ArduinoJson.h>
